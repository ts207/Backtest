# Gap Matrix

| Requirement | Status (met/partial/missing) | Evidence (file path + line range) | Notes/Risks | Proposed change | How to verify |
|---|---|---|---|---|---|
| R1 Net-of-cost performance accounting | met | Interface: `project/pipelines/backtest/backtest_strategies.py:379-418`, `project/pipelines/backtest/backtest_strategies.py:444-450`, `project/pipelines/backtest/backtest_strategies.py:576-593`, `project/pipelines/run_all.py:551-560`; Behavior: `tests/test_backtest_metadata_and_costs.py:15-27`, `tests/test_backtest_metadata_and_costs.py:55-113`, `tests/test_backtest_metadata_and_costs.py:215-227`, `tests/test_run_all_phase2.py:179-228` | Cost decomposition and cost-arg passthrough are implemented and tested. | Deferred (analysis-only task). | `./.venv/bin/python -m pytest -q tests/test_backtest_metadata_and_costs.py tests/test_run_all_phase2.py::test_run_all_includes_backtest_and_report_when_enabled` |
| R2 Time-respecting out-of-sample validation | met | Interface: `project/pipelines/research/analyze_conditional_expectancy.py:153-197`, `project/pipelines/research/phase2_conditional_hypotheses.py:33-75`, `project/pipelines/research/phase2_conditional_hypotheses.py:823-836`, `project/pipelines/research/phase2_conditional_hypotheses.py:1034-1041`, `project/pipelines/research/validate_expectancy_traps.py:393-419`, `project/pipelines/research/validate_expectancy_traps.py:543-547`; Behavior: `tests/test_phase2_conditional_hypotheses.py:270-293`, `tests/test_phase2_conditional_hypotheses.py:295-319`, `tests/test_phase2_conditional_hypotheses.py:322-359`, `tests/test_validate_expectancy_traps.py:37-65` | Train/validation/test split labels, OOS gating, and embargo overlap diagnostics are present. | Deferred (analysis-only task). | `./.venv/bin/python -m pytest -q tests/test_phase2_conditional_hypotheses.py tests/test_validate_expectancy_traps.py` |
| R3 Multiple-testing / data-snooping controls | met | Interface: `project/pipelines/research/analyze_conditional_expectancy.py:126-150`, `project/pipelines/research/analyze_conditional_expectancy.py:200-212`, `project/pipelines/research/analyze_conditional_expectancy.py:396-432`, `project/pipelines/research/phase2_conditional_hypotheses.py:1080-1092`, `project/pipelines/research/phase2_conditional_hypotheses.py:1145-1153`; Behavior: `tests/test_analyze_conditional_expectancy_multiplicity.py:12-28`, `tests/test_phase2_conditional_hypotheses.py:270-293` | BH-adjusted p-values are persisted and used in promotion gates. | Deferred (analysis-only task). | `./.venv/bin/python -m pytest -q tests/test_analyze_conditional_expectancy_multiplicity.py tests/test_phase2_conditional_hypotheses.py::test_phase2_manifest_and_candidates_include_oos_and_multiplicity_fields` |
| R4 Data QA and provenance gating | met | Interface: `project/pipelines/clean/build_cleaned_15m.py:175-235`, `project/pipelines/clean/build_cleaned_15m.py:244-275`, `project/pipelines/clean/build_cleaned_15m.py:281-315`, `project/pipelines/clean/build_cleaned_15m.py:371-393`, `project/pipelines/_lib/run_manifest.py:23-47`, `project/pipelines/features/build_features_v1.py:210-267`, `project/pipelines/features/build_features_v1.py:322-323`; Behavior: `tests/test_manifest_provenance.py:47-93`, `tests/test_manifest_provenance.py:95-104` | Timestamp/schema checks, gap stats, and provenance validation are implemented with failing behavior on missing provenance. | Deferred (analysis-only task). | `./.venv/bin/python -m pytest -q tests/test_manifest_provenance.py` |
| R5 Mechanism-grounded feature coverage | partial | Interface present: `project/pipelines/features/build_features_v1.py:74-151`, `project/pipelines/features/build_features_v1.py:162-167`, `project/pipelines/features/build_features_v1.py:247-283`, `project/pipelines/alpha_bundle/build_onchain_flow_signal.py:52-61`, `project/pipelines/alpha_bundle/build_onchain_flow_signal.py:135-142`; Gap evidence: `project/strategies/spread_desync_v1.py:14-24` vs `project/pipelines/features/build_features_v1.py:269-283`; Behavior: `tests/test_build_features_milestone_d.py:32-73` | Funding/OI/liquidation/revision lag are covered, but `basis_zscore` is required by spread strategy and not produced in `features_v1`; on-chain flow remains AlphaBundle-side, not mainline feature store. | Deferred (analysis-only task). | `./.venv/bin/python -m pytest -q tests/test_build_features_milestone_d.py tests/test_strategy_adapters.py` |
| R6 Derivatives realism: funding + borrow in PnL | met | Interface: `project/engine/pnl.py:15-79`, `project/engine/runner.py:258-276`, `project/engine/runner.py:303-307`, `project/pipelines/backtest/backtest_strategies.py:404-416`, `project/pipelines/backtest/backtest_strategies.py:587-593`; Behavior: `tests/test_engine_pnl_components.py:12-24`, `tests/test_backtest_metadata_and_costs.py:112-113`, `tests/test_backtest_metadata_and_costs.py:215-227` | Funding and borrow components are modeled and propagated to metrics payloads. | Deferred (analysis-only task). | `./.venv/bin/python -m pytest -q tests/test_engine_pnl_components.py tests/test_backtest_metadata_and_costs.py::test_cost_components_include_funding_and_borrow_in_net_alpha` |
| R7 Reproducibility + config/code/data versioning | partial | Interface present: `project/pipelines/backtest/backtest_strategies.py:350-376`, `project/pipelines/backtest/backtest_strategies.py:593-599`, `project/pipelines/research/phase2_conditional_hypotheses.py:909-910`, `project/pipelines/research/phase2_conditional_hypotheses.py:1065`, `project/pipelines/research/phase2_conditional_hypotheses.py:1151-1153`; Behavior: `tests/test_backtest_metadata_and_costs.py:30-53`, `tests/test_backtest_metadata_and_costs.py:55-114`, `tests/test_phase2_conditional_hypotheses.py:270-279`; Gap evidence: `project/pipelines/run_all.py:66-116` | Backtest reproducibility metadata and Phase2 hypothesis diary exist, but there is no repo-wide deterministic seed contract at orchestration level. | Deferred (analysis-only task). | `./.venv/bin/python -m pytest -q tests/test_backtest_metadata_and_costs.py tests/test_phase2_conditional_hypotheses.py::test_phase2_manifest_and_candidates_include_oos_and_multiplicity_fields` |
| R8 Robustness suite (regime, cost stress, parameter stability, capacity) | met | Interface: `project/pipelines/research/validate_expectancy_traps.py:577-683`, `project/pipelines/research/validate_expectancy_traps.py:421-482`, `project/pipelines/backtest/backtest_strategies.py:617-659`, `project/pipelines/report/make_report.py:183-185`, `project/pipelines/report/make_report.py:241-253`; Behavior: `tests/test_validate_expectancy_traps.py:37-65`, `tests/test_validate_expectancy_traps.py:67-96` | Regime/tail/symmetry/leakage diagnostics, fee stress scenarios, stability diagnostics, and capacity diagnostics are present. | Deferred (analysis-only task). | `./.venv/bin/python -m pytest -q tests/test_validate_expectancy_traps.py` |
| R9 Deployment gates, monitoring, and kill-switch controls | partial | Interface present: `project/pipelines/research/generate_recommendations_checklist.py:149-154`, `project/pipelines/research/generate_recommendations_checklist.py:236-244`, `project/pipelines/research/generate_recommendations_checklist.py:90-147`, `project/pipelines/run_all.py:51-53`, `project/pipelines/run_all.py:485-492`; Behavior: `tests/test_generate_recommendations_checklist.py:11-75`, `tests/test_generate_recommendations_checklist.py:77-124`, `tests/test_run_all_phase2.py:34-45` | Machine-readable go/no-go exists, but checklist failure is explicitly non-fatal in orchestrator and there is no explicit feed/execution/cost/risk drift gate set. | Deferred (analysis-only task). | `./.venv/bin/python -m pytest -q tests/test_generate_recommendations_checklist.py tests/test_run_all_phase2.py::test_recommendations_checklist_keep_research_is_non_fatal` |
| R10 Case-study strategy coverage | partial | Interface present: `project/strategies/registry.py:13-20`, `project/strategies/carry_funding_v1.py:11-19`, `project/strategies/mean_reversion_exhaustion_v1.py:12-19`, `project/strategies/spread_desync_v1.py:12-19`, `project/pipelines/alpha_bundle/build_onchain_flow_signal.py:52-61`; Gap evidence: `project/strategies/registry.py:13-20` (no on-chain strategy template), `project/strategies/overlay_registry.py:129-153` (no explicit MEV-aware overlay gate in code path); Behavior: `tests/test_strategy_adapters.py:42-53`, `tests/test_strategy_adapters.py:106-122` | Carry/mean-reversion/spread templates are runnable and tested, but on-chain is currently signal-only and no explicit MEV-aware execution-quality overlay is implemented. | Deferred (analysis-only task). | `./.venv/bin/python -m pytest -q tests/test_strategy_adapters.py tests/test_strategy_family_params.py` |
| R11 Survivorship-bias controls | met | Interface: `project/pipelines/ingest/build_universe_snapshots.py:74-93`, `project/pipelines/ingest/build_universe_snapshots.py:114-127`, `project/engine/runner.py:118-150`, `project/engine/runner.py:427-443`, `project/pipelines/report/make_report.py:386-397`, `project/pipelines/report/make_report.py:437-439`; Behavior: `tests/test_universe_snapshot_eligibility.py:34-62` | Timestamped listing windows, eligibility masking, and monthly membership reporting exist. Residual risk: still depends on operator-provided symbol universe. | Deferred (analysis-only task). | `./.venv/bin/python -m pytest -q tests/test_universe_snapshot_eligibility.py` |
